class Observer{constructor(){this.items=[]}add(a,c){this.items.push({name:a,callback:c})}fire(){this.items.forEach(a=>{a.callback()})}}
class Dialog{constructor(a,c){this.options={dialogClassName:null,dialogPlaceholderClassName:null,size:{x:0,y:0},position:{},autoShow:!0,autoClose:!1,closeOnEsc:!0,closeOnOutsideClick:!0,callback:{onBeforeShow:null,onShow:null,onClose:null},linkTo:null};this.options=Object.assign(this.options,c);this.create(a)}static isChild(a,c){c=c.getElementsByTagName("*");for(let b=0;b<c.length;b++)if(c[b]===a)return!0;return!1}static closeAll(){document.querySelectorAll(".dialog[dialog-id]").forEach(a=>{"function"===
typeof a.close?a.close():a.parentNode.removeChild(a)})}create(a){this.dlg=document.createElement("div");this.dlgPlaceholder=document.createElement("div");this.dlgPlaceholder.classList.add("dialog-placeholder");this.dlg.classList.add("dialog");null!==this.options.dialogPlaceholderClassName&&this.dlgPlaceholder.classList.add(this.options.dialogPlaceholderClassName);null!==this.options.dialogClassName&&this.dlg.classList.add(this.options.dialogClassName);this.dlgPlaceholder.setAttribute("dialog-id",
Math.random().toString(36).substring(2,9));this.dlgPlaceholder.style.visibility="hidden";this.dlg.setAttribute("dialog-id",Math.random().toString(36).substring(2,9));this.dlg.innerHTML=a;document.body.appendChild(this.dlgPlaceholder);a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0;let c=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0;if(null!==this.options.linkTo)this.options.linkTo.parentNode.insertBefore(this.dlg,this.options.linkTo.nextSibling),
this.dlg.style.marginLeft=void 0!==this.options.position.x?`${this.options.position.x}px`:0,this.dlg.style.marginTop=void 0!==this.options.position.y?`${this.options.position.y}px`:0;else{this.dlgPlaceholder.appendChild(this.dlg);var b=getComputedStyle(this.dlg);const d=b.getPropertyValue("width");b=b.getPropertyValue("height");this.options.size={x:d.match(/px/)?parseInt(d.replace(/px/,"")):d.match(/%/)?a*parseInt(d.replace(/%/,""))/100:this.dlg.offsetWidth,y:b.match(/px/)?parseInt(b.replace(/px/,
"")):b.match(/%/)?c*parseInt(b.replace(/%/,""))/100:this.dlg.offsetHeight};this.dlg.style.marginLeft=void 0!==this.options.position.x?`${this.options.position.x}px`:`${(a-parseInt(this.options.size.x))/2}px`;this.dlg.style.marginTop=void 0!==this.options.position.y?`${this.options.position.y}px`:`${(c-parseInt(this.options.size.y))/2}px`}this.options.autoClose&&setTimeout(()=>{this.close()},1E3*parseInt(this.options.autoClose));this.options.closeOnEsc&&document.addEventListener("keyup",d=>{let e=
d.code;d=d.target;3===d.nodeType&&(d=d.parentNode);/(ArrowUp|ArrowDown|Escape|Space)/.test(e)&&!/input|textarea/i.test(d.tagName)&&"Escape"===e&&this.isVisible()&&this.close()});this.options.closeOnOutsideClick&&this.dlgPlaceholder.addEventListener("click",d=>{d=d.target;this.isVisible()&&d!==this.dlg&&!Dialog.isChild(d,this.dlg)&&this.close()});Object.defineProperty(this.dlg,"show",{value:()=>{if("function"===typeof this.options.callback.onBeforeShow)this.options.callback.onBeforeShow();this.dlgPlaceholder.style.visibility=
"visible";if("function"===typeof this.options.callback.onShow)this.options.callback.onShow()},configurable:!0});Object.defineProperty(this.dlg,"close",{value:()=>{if(this.isVisible()){if("function"===typeof this.options.callback.onClose)this.options.callback.onClose();this.dlg.parentNode&&this.dlg.parentNode.removeChild(this.dlg);this.dlgPlaceholder.parentNode&&this.dlgPlaceholder.parentNode.removeChild(this.dlgPlaceholder);this.dlgPlaceholder=null}},configurable:!0});this.options.autoShow&&this.show()}isVisible(){return this.dlgPlaceholder&&
"hidden"!==this.dlgPlaceholder.style.visibility}isCreated(){return null!==this.dlgPlaceholder}close(){this.dlg.close()}show(){this.dlg.show()}}
const vivCoin=(()=>({options:{url:"https://vivcoin.idealweb.ro/"},spin:'<div class="spinner spinner-sm"></div>',ob:new Observer,api:async function(a,c="GET",b=""){b={method:c,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:b?JSON.stringify(b):""};"GET"!==c&&"HEAD"!==c||delete b.body;return await fetch(`${vivCoin.options.url}${a}`,b)},route:function(){const a=["route","method","query"];var c=window.location.pathname;
const b=window.location.hash,d={};if(c&&(c=c.replace(/^\/?|\/?$/g,"").split("/"),0<c.length))for(let e=0;e<a.length;e++)d[a[e]]=c[e];b&&(d.hash=b.substring(1));return d},dd:function(){const a=document.querySelectorAll(".trigger-dropdown-menu");0<a.length&&a.forEach(c=>{let b=c.getAttribute("data-ref"),d=document.querySelector(b);b&&d&&c.addEventListener("click",e=>{e.preventDefault();e.stopPropagation();c.classList.add("selected");Dialog.closeAll();new Dialog(d.innerHTML,{dialogClassName:"dialog",
dialogPlaceholderClassName:"dialog-placeholder",closeOnEsc:!0,closeOnOutsideClick:!0,linkTo:c,callback:{onClose:()=>{c.classList.remove("selected")}},position:{x:-4,y:7}})})})},dialog:function(a,c=null){a=document.querySelectorAll(a);0<a.length&&a.forEach(b=>{let d=b.getAttribute("data-ref"),e=document.querySelector(d);d&&e&&b.addEventListener("click",()=>{Dialog.closeAll();const f=new Dialog(e.innerHTML,{dialogClassName:"dialog-shadowed",dialogPlaceholderClassName:"dialog-placeholder-shadowed",closeOnEsc:!0,
closeOnOutsideClick:!1});c&&c(f,b.dataset||null);const g=f.dlg.querySelector(".close-dialog");g&&g.addEventListener("click",h=>{h.preventDefault();h.stopPropagation();f.close()})})})},language:function(){const a=document.querySelector(".lang");if(a){let c=a.getAttribute("data-ref"),b=document.querySelector(c);c&&b&&a.addEventListener("click",d=>{d.preventDefault();d.stopPropagation();a.classList.add("selected");Dialog.closeAll();new Dialog(b.innerHTML,{dialogClassName:"dialog-languages",dialogPlaceholderClassName:"dialog-placeholder",
closeOnEsc:!0,closeOnOutsideClick:!0,linkTo:a,callback:{onClose:()=>{a.classList.remove("selected")}},position:{x:-4,y:7}})})}},notify:function(a,c,b="error",d=0){a&&(a.classList.add("notification","notification-sm","notification-inline"),a.classList.remove("error","success","info","warning"),a.classList.add(b),a.innerHTML=c,0<d&&setTimeout(()=>{a.classList.remove("notification","notification-sm","notification-inline");a.innerHTML=""},1E3*d))},metrics:function(){const a=document.querySelector(".coin-metrics");
if(a){const c=JSON.parse(atob(a.getAttribute("data-lang")));vivCoin.ob.add("renderMetrics",()=>{a.innerHTML=vivCoin.spin;vivCoin.api("api/public/market/").then(b=>b.json()).then(b=>{if(!b.error){const d=[];d.push(`<h3>${c["heading.exchange"]}</h3>`);d.push(`<p>1 VIVcoin = ${b.market.price} RON</p>`);a.innerHTML=d.join("")}}).catch(b=>console.log(b))});vivCoin.ob.fire();setInterval(()=>{vivCoin.ob.fire()},3E4)}}}))();(()=>{vivCoin.language();vivCoin.dd();vivCoin.metrics()})();
