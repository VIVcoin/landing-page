class Observer{constructor(){this.items=[]}add(e,b){this.items.push({name:e,callback:b})}fire(){this.items.forEach(e=>{e.callback()})}}
class Dialog{constructor(e,b){this.options={dialogClassName:null,dialogPlaceholderClassName:null,size:{x:0,y:0},position:{},autoShow:!0,autoClose:!1,closeOnEsc:!0,closeOnOutsideClick:!0,callback:{onBeforeShow:null,onShow:null,onClose:null},linkTo:null};this.options=Object.assign(this.options,b);this.create(e)}static isChild(e,b){b=b.getElementsByTagName("*");for(let a=0;a<b.length;a++)if(b[a]===e)return!0;return!1}static closeAll(){document.querySelectorAll(".dialog[dialog-id]").forEach(e=>{"function"===
typeof e.close?e.close():e.parentNode.removeChild(e)})}create(e){this.dlg=document.createElement("div");this.dlgPlaceholder=document.createElement("div");this.dlgPlaceholder.classList.add("dialog-placeholder");this.dlg.classList.add("dialog");null!==this.options.dialogPlaceholderClassName&&this.dlgPlaceholder.classList.add(this.options.dialogPlaceholderClassName);null!==this.options.dialogClassName&&this.dlg.classList.add(this.options.dialogClassName);this.dlgPlaceholder.setAttribute("dialog-id",
Math.random().toString(36).substring(2,9));this.dlgPlaceholder.style.visibility="hidden";this.dlg.setAttribute("dialog-id",Math.random().toString(36).substring(2,9));this.dlg.innerHTML=e;document.body.appendChild(this.dlgPlaceholder);e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0;let b=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0;if(null!==this.options.linkTo)this.options.linkTo.parentNode.insertBefore(this.dlg,this.options.linkTo.nextSibling),
this.dlg.style.marginLeft=void 0!==this.options.position.x?`${this.options.position.x}px`:0,this.dlg.style.marginTop=void 0!==this.options.position.y?`${this.options.position.y}px`:0;else{this.dlgPlaceholder.appendChild(this.dlg);var a=getComputedStyle(this.dlg);const c=a.getPropertyValue("width");a=a.getPropertyValue("height");this.options.size={x:c.match(/px/)?parseInt(c.replace(/px/,"")):c.match(/%/)?e*parseInt(c.replace(/%/,""))/100:this.dlg.offsetWidth,y:a.match(/px/)?parseInt(a.replace(/px/,
"")):a.match(/%/)?b*parseInt(a.replace(/%/,""))/100:this.dlg.offsetHeight};this.dlg.style.marginLeft=void 0!==this.options.position.x?`${this.options.position.x}px`:`${(e-parseInt(this.options.size.x))/2}px`;this.dlg.style.marginTop=void 0!==this.options.position.y?`${this.options.position.y}px`:`${(b-parseInt(this.options.size.y))/2}px`}this.options.autoClose&&setTimeout(()=>{this.close()},1E3*parseInt(this.options.autoClose));this.options.closeOnEsc&&document.addEventListener("keyup",c=>{let f=
c.code;c=c.target;3===c.nodeType&&(c=c.parentNode);/(ArrowUp|ArrowDown|Escape|Space)/.test(f)&&!/input|textarea/i.test(c.tagName)&&"Escape"===f&&this.isVisible()&&this.close()});this.options.closeOnOutsideClick&&this.dlgPlaceholder.addEventListener("click",c=>{c=c.target;this.isVisible()&&c!==this.dlg&&!Dialog.isChild(c,this.dlg)&&this.close()});Object.defineProperty(this.dlg,"show",{value:()=>{if("function"===typeof this.options.callback.onBeforeShow)this.options.callback.onBeforeShow();this.dlgPlaceholder.style.visibility=
"visible";if("function"===typeof this.options.callback.onShow)this.options.callback.onShow()},configurable:!0});Object.defineProperty(this.dlg,"close",{value:()=>{if(this.isVisible()){if("function"===typeof this.options.callback.onClose)this.options.callback.onClose();this.dlg.parentNode&&this.dlg.parentNode.removeChild(this.dlg);this.dlgPlaceholder.parentNode&&this.dlgPlaceholder.parentNode.removeChild(this.dlgPlaceholder);this.dlgPlaceholder=null}},configurable:!0});this.options.autoShow&&this.show()}isVisible(){return this.dlgPlaceholder&&
"hidden"!==this.dlgPlaceholder.style.visibility}isCreated(){return null!==this.dlgPlaceholder}close(){this.dlg.close()}show(){this.dlg.show()}}
const vivCoin=(()=>{function e(b,a,c="error",f=0){b&&(b.classList.add("notification","notification-sm","notification-inline"),b.classList.remove("error","success","info","warning"),b.classList.add(c),b.innerHTML=a,0<f&&setTimeout(()=>{b.classList.remove("notification","notification-sm","notification-inline");b.innerHTML=""},1E3*f))}return{options:{url:"https://vivcoin.idealweb.ro/"},spin:'<div class="spinner spinner-sm"></div>',ob:new Observer,api:async function(b,a="GET",c=""){c={method:a,mode:"cors",
cache:"no-cache",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:c?JSON.stringify(c):""};"GET"!==a&&"HEAD"!==a||delete c.body;return await fetch(`${vivCoin.options.url}${b}`,c)},route:function(){const b=["route","method","query"];var a=window.location.pathname;const c=window.location.hash,f={};if(a&&(a=a.replace(/^\/?|\/?$/g,"").split("/"),0<a.length))for(let d=0;d<b.length;d++)f[b[d]]=a[d];c&&(f.hash=c.substring(1));return f},dd:function(){const b=
document.querySelectorAll(".trigger-dropdown-menu");0<b.length&&b.forEach(a=>{let c=a.getAttribute("data-ref"),f=document.querySelector(c);c&&f&&a.addEventListener("click",d=>{d.preventDefault();d.stopPropagation();a.classList.add("selected");Dialog.closeAll();new Dialog(f.innerHTML,{dialogClassName:"dialog",dialogPlaceholderClassName:"dialog-placeholder",closeOnEsc:!0,closeOnOutsideClick:!0,linkTo:a,callback:{onClose:()=>{a.classList.remove("selected")}},position:{x:-4,y:7}})})})},dialog:function(b,
a=null){b=document.querySelectorAll(b);0<b.length&&b.forEach(c=>{let f=c.getAttribute("data-ref"),d=document.querySelector(f);f&&d&&c.addEventListener("click",()=>{Dialog.closeAll();const g=new Dialog(d.innerHTML,{dialogClassName:"dialog-shadowed",dialogPlaceholderClassName:"dialog-placeholder-shadowed",closeOnEsc:!0,closeOnOutsideClick:!1});a&&a(g,c.dataset||null);const h=g.dlg.querySelector(".close-dialog");h&&h.addEventListener("click",k=>{k.preventDefault();k.stopPropagation();g.close()})})})},
language:function(){const b=document.querySelector(".lang");b&&vivCoin.api("api/public/preferences/").then(a=>a.json()).then(a=>{if(!a.error){const c=a.preferences.lang,f=[];a.preferences.languages&&(a.preferences.languages.forEach(d=>{d.name===c?b.innerHTML=`<img src="${vivCoin.options.url}${d.icon}" alt="${d.label}"> ${d.label}`:f.push(`<li><a href="#" class="btn-change-language" data-lang="${d.name}"><img src="${vivCoin.options.url}${d.icon}" alt="${d.label}"> ${d.label}</a></li>`)}),b.addEventListener("click",
d=>{d.preventDefault();d.stopPropagation();d=document.querySelector(".dialog-languages");null===d?(Dialog.closeAll(),d=(new Dialog(`<ul>${f.join("")}</ul>`,{dialogClassName:"dialog-languages",dialogPlaceholderClassName:"dialog-placeholder",closeOnEsc:!0,closeOnOutsideClick:!0,linkTo:b,position:{x:-4}})).dlg.querySelectorAll(".btn-change-language"),0<d.length&&d.forEach(g=>{let h=g.getAttribute("data-lang");h&&g.addEventListener("click",k=>{k.preventDefault();k.stopPropagation();vivCoin.api("api/public/preferences/",
"PATCH",{action:"update-language",value:{lang:h}}).then(l=>l.json()).then(l=>{l.error||location.reload()}).catch(l=>vivCoin.notify(e,l))})})):(d.parentNode.removeChild(d),Dialog.closeAll())}))}}).catch(a=>console.log(a))},notify:e}})();(()=>{vivCoin.language();vivCoin.dd()})();
